---
title: "Isn't that a TikTok song?"
author: "Anna Lau"
date: "9-2-2021"
# runtime: shiny
output:
  flexdashboard::flex_dashboard:
    storyboard: true
    theme: flatly
# output: html_document
  
---
```{r, echo = FALSE}
library(spotifyr)
library(tidyverse)
library(plotly)
mar <-get_playlist_audio_features("","0IIt2QOYxRawDHQbZ8ln3M") 
apr <-get_playlist_audio_features("","0PTklfVTalxE8j6T9NYZEG") 
may <-get_playlist_audio_features("","093VTj7Esn9nYiFQFoa1YH") 
jun <-get_playlist_audio_features("","2F3YMerEwMjXn3A4S7es6H") 
jul <-get_playlist_audio_features("","4U9w6uCKivCsRLHFyZgkxI") 
aug <-get_playlist_audio_features("","3zvNyJbb9rjdF0vag2O5xG")
sep <-get_playlist_audio_features("","2APegDsKij3yaL1ffG6Bz4") 
oct <-get_playlist_audio_features("","4np9mWC6T4O8x7hoxTeUPP") 
nov <-get_playlist_audio_features("","5xyKvHZIeWGAgWJ6ZEVm3H") 
dec <-get_playlist_audio_features("","4n90Xr0lxy1yLhbzTAgzTx") 

corpus <- 
  bind_rows(
    mar %>% mutate(category = "Mar"),
    apr %>% mutate(category = "Apr"),
    may %>% mutate(category = "May"),
    jun %>% mutate(category = "Jun"),
    jul %>% mutate(category = "Jul"),
    aug %>% mutate(category = "Aug"),
    sep %>% mutate(category = "Sep"),
    oct %>% mutate(category = "Oct"),
    nov %>% mutate(category = "Nov"),
    dec %>% mutate(category = "Dec")
  )

# Delete duplicate songs
corpus <- corpus[!duplicated(corpus$track.name),]
pop_sorted <- corpus[order(-corpus$track.popularity),]
```



### Yeah you've heard this before

```{r}
popularity_plot <- corpus %>%
  mutate(track.name = fct_reorder(track.name, track.popularity)) %>%
  ggplot(aes(x=track.name, y=track.popularity)) +
    geom_segment( aes(x = track.name, xend=track.name, y = 0, yend=track.popularity)) +
    geom_point( size=1, color="skyblue") +
    coord_flip() +
    xlab("") +
    ylab("Popularity")+
    theme_minimal() +
    # theme(
    #   
    # ) + 
  labs(title = "Corpus track popularity",
       y = "Popularity",
       x = "Track title")+
  theme(
    panel.grid.major.y = element_blank(),
    panel.border = element_blank(),
    axis.text.y = element_text(size = 4.5),
    axis.ticks.y = element_blank(),
    axis.ticks.x = element_blank(),
  )

ggplotly(popularity_plot)
```

***

The corpus for this project is a playlist from Spotify. This playlists is a collection of songs that are famous from TikTok - a short-form video social media app. In these 15 seconds videos music is played and people lip-sync, dance and make music-driven memes. As the spaces people normally enjoy music were impacted by the pandamic, TikTok helped fill the need for communal musical experience all over the world. Hence the songs from the corpus will be the top 10 songs on TikTok from the beginning of the coronavirus pandemic (March 2020) till the end of 2020 (December 2020). The top songs are acquired from <https://tokboard.com/months>. If a song in the top 10 of the month was not available on Spotify the song is skipped and the 11th song was added. If a song was repeatedly listed in the top 10 the song was skipped. This resulted in a total of 83 songs a total of 4 hours and 9 minutes. 
<!-- I want to find out how different these popular TikTok songs are from one another. The genres of the songs are quite diverse. Maybe there is a factor that is a core element of becoming a suitable TikTok song. In addition, as TikTok videos have a wide variety of trends, I want to find out if the songs within a trend are the same/different. I.e. are all dance tiktok songs alike? How are alike are meme TikTok songs? etc.  -->

That songs were popular on TikTok does not have to mean they are popular on Spotify. Let's explore the plot on the right. As we can see most of the 84 songs are above a popularity level of 50. Only 10 of the 84 songs have a popularity score lower than 50. 


### Ain't that strange that I want to move my body to these songs. 
```{r}
dance_tracks <- c("What You Know Bout Love", "WAP (feat. Megan Thee Stallion)",
          "Roses - Imanbek Remix", "TKN (feat. Travis Scott)",
          "You Got It", "Toosie Slide",
          "Shower", "How You Like That",
          "Supalonely", "Party Girl")
dance_songs <- corpus %>%
  filter(track.name %in% dance_tracks)

ggplot(corpus, aes(x = danceability, y = energy, size = tempo)) +
  geom_point() +
  geom_point(data = dance_songs,
             aes(x = danceability,
                 y = energy,
                 color = track.name,
                 size = tempo
                 )
             )+
  geom_rug(size = 0.1) +      # Add 'fringes' to show data distribution.
  scale_x_continuous(         # Fine-tune the x axis.
    limits = c(0, 1),
    breaks = c(0, 0.50, 1),   # Use grid-lines for quadrants only.
    minor_breaks = NULL       # Remove 'minor' grid-lines.
  ) +
  scale_y_continuous(         # Fine-tune the y axis in the same way.
    limits = c(0, 1),
    breaks = c(0, 0.50, 1),
    minor_breaks = NULL
  ) +
  theme_light()+
  # ylim(0,1.0) +
  # xlim(0,1.0) + 
  labs(x = "Danceability",
       y = "Energy",
       size = "Tempo",
       color = "Track")
```

***
One of the biggest trends of TikTok are the *Viral Dances* almost everybody just had to learn. Here, a graphic displays how danceable a track is. This is broken down into Danceability, Energy and Tempo features from the [Spotify API](https://developer.spotify.com).

To no surprise does the majority of the tracks have a high danceability as most TikTok songs are dance challenges. Zooming in into the top 10 dance songs, the coloured dots have a danceability mean of 0.78. It is on the higher side, but not the highest. The reason for this can be that these songs have a fairly easy choreography, so that everyone can enjoy dancing to them together on TikTok. Increasing the difficulty of a choreography would probably lower the popularity, as less people would be able to perform the dance. Tracks with a higher danceability score often not labelled as dance songs. The track with the lowest danceability score of 0.676 is *Steven Universe* - L.Dre which is a low-fi hiphop song often used as background music for the TikTok video. The track with the highest danceability score is used for a dance challenge trend on TikTok. 

The track with the highest energy is *Mere Sapno Ki Rani - Tik Tok Remix* - from Eduardo Luzqui√±os ranked as penultimate of all songs in this corpus. There is no real trend linked to this song. 

### Same but different 

```{r}
bananas <- corpus %>% 
  filter(str_detect(corpus$track.name, "Banana"))

library(compmus)

## Conkarah, Shaggy
banana_orig <-
  get_tidy_audio_analysis("13OdVDwHdPlGkKHyjPoadB") %>%
  select(segments) %>%
  unnest(segments) %>%
  select(start, duration, pitches)
## Conkarah, Shaggy, DJ Fle
banana_remix <-
  get_tidy_audio_analysis("0dZpw3h6KZhcHec61qwevZ") %>%
  select(segments) %>%
  unnest(segments) %>%
  select(start, duration, pitches)

banana_dtw <- compmus_long_distance(
  banana_orig  %>% mutate(pitches = map(pitches, compmus_normalise, "euclidean")),
  banana_remix %>% mutate(pitches = map(pitches, compmus_normalise, "euclidean")),
  feature = pitches,
  method = "angular"
) %>%
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_equal() +
  labs(x = "Original", y = "Remix", title = "Banana song") +
  theme_minimal() +
  scale_fill_viridis_c(guide = NULL)

banana_orig_chroma <- banana_orig %>%
  mutate(pitches = map(pitches, compmus_normalise, "euclidean")) %>%
  compmus_gather_chroma() %>% 
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = pitch_class,
      fill = value
    )
  ) +
  geom_tile() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude", title = "Original Banana song") +
  theme_minimal() +
  scale_fill_viridis_c()

banana_remix_chroma <- banana_remix %>%
  mutate(pitches = map(pitches, compmus_normalise, "euclidean")) %>%
  compmus_gather_chroma() %>% 
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = pitch_class,
      fill = value
    )
  ) +
  geom_tile() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude", title = "Remix Banana song") +
  theme_minimal() +
  scale_fill_viridis_c()
```


<div style='display:flex; flex-direction:row; justify-content:space-evenly; align-items:center;'>
<div>
<div style='display:flex; flex-direction:column; justify-content:space-evenly; align-items:center;'>
<div>
```{r}]

ggplotly(banana_orig_chroma)
```

</div>
<div>
```{r}
ggplotly(banana_remix_chroma)
```
</div>
</div>
</div>

<div>
```{r}
ggplotly(banana_dtw)
```

</div>

<div style="width = 120px">
Plotted with Euclidean normalisation and angular distance. When listening to the songs, it does not seem like there is much difference between the two. Only the remix version is 26 seconds longer than the original Banana song and the last 17 seconds are silent. However, the Dynamic Time Warping of the chromagrams does not show that that the songs are the same.
</div>


